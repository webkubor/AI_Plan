下面这份 **PM2 常用命令笔记**，我按「你可以直接复制到笔记里、随时查」的方式整理好了。内容覆盖：启动/重启/停止、查看状态、日志、监控、配置文件、开机自启、集群模式、更新与排错。

# **✅ PM2 常用命令速查笔记（建议收藏）**



#### 约定：

- > app 是应用名（你自定义）

- > id 是 pm2 分配的进程编号

- > ecosystem.config.js 是 pm2 配置文件（常用）





------





## **1）基础启动 / 停止 / 重启**



### **启动一个 Node 脚本**

```
pm2 start app.js
```



### **启动并命名（强烈推荐）**

```
pm2 start app.js --name app
```

### **启动并指定运行环境变量（NODE_ENV）**

```
pm2 start app.js --name app --env production
```



### **停止**

```
pm2 stop app
pm2 stop id
```



### **重启（代码更新后常用）**



```
pm2 restart app
pm2 restart id
```



### **重载（reload，适合无损更新，常用于 http 服务）**

```
pm2 reload app
```



### **删除进程（从 pm2 列表移除）**

```
pm2 delete app
pm2 delete id
```

## **2）查看进程状态 / 信息**

### **查看所有进程状态列表（最常用）**

```
pm2 list
```

### **只看某个进程详情（包含环境变量、路径、重启次数等）**



```
pm2 describe app
pm2 describe id
```

### **查看某个进程信息（简略）**



```
pm2 show app
```



## **3）日志（排错最常用）**







### **查看所有应用日志（实时）**



```
pm2 logs
```



### **查看指定应用日志**



```
pm2 logs app
pm2 logs id
```



### **只看最近 N 行日志**



```
pm2 logs app --lines 200
```



### **清空日志（⚠️ 会清空历史日志文件）**



```
pm2 flush
```



## **4）资源监控**



### **进入监控面板（CPU/内存/重启次数/日志）**



```
pm2 monit
```



------





## **5）持久化进程列表（重要）**



> PM2 的「进程列表」不会自动永久保存，必须手动保存。

### 保存当前进程列表（非常重要）

```
pm2 save
```

### **恢复保存的进程列表（服务器重启后）**

```
pm2 resurrect
```



------



## **6）设置开机自启（服务器必备）**





### **生成开机启动命令（运行后会提示你下一条要复制执行的命令）**



```
pm2 startup
```

> 执行完会输出一条类似：

> sudo env PATH=$PATH:/usr/bin pm2 startup systemd -u xxx --hp /home/xxx

> 你照着复制执行即可。





### **最后别忘了保存**



```
pm2 save
```



------





## **7）集群模式（多核提升吞吐）**







### **启动集群（自动按 CPU 核数启动）**



```
pm2 start app.js -i max --name app
```



### **指定实例数量**



```
pm2 start app.js -i 4 --name app
```

> 说明：集群模式适合 Web 服务（Koa/Express/Nest），不适合有本地状态的任务型进程。



------





## **8）使用配置文件（推荐生产环境用）**







### **生成配置文件（你也可以手写）**



```
pm2 ecosystem
```

会生成一个 ecosystem.config.js





### **按配置启动**



```
pm2 start ecosystem.config.js
```



### **重启配置文件内所有应用**



```
pm2 restart ecosystem.config.js
```



### **只操作某个应用（配置文件里定义的 name）**



```
pm2 restart ecosystem.config.js --only app
```



------





## **9）更新代码的正确姿势（常用流程）**







### **方式 A：简单重启**



```
git pull
pm2 restart app
```



### **方式 B：无损重载（推荐 Web 服务）**



```
git pull
pm2 reload app
```



------





## **10）常用排错命令**







### **查看 PM2 自身日志**



```
pm2 logs pm2
```



### **查看环境变量/启动命令是否正确**



```
pm2 describe app
```



### **检查端口占用（常见端口被占导致启动失败）**



```
lsof -i :3000
```



### **进程一直重启（重启次数高）通常是启动报错 → 看日志**



```
pm2 logs app --lines 300
```





## **11）PM2 自身升级 / 版本**





### **查看版本**

```
pm2 -v
```

### **全局更新 PM2（⚠️ 会更新工具版本）**

```
npm i -g pm2
```

------



#### ⭐ 最常用的 10 条

```
pm2 start app.js --name app
pm2 list
pm2 logs app
pm2 restart app
pm2 reload app
pm2 stop app
pm2 delete app
pm2 save
pm2 resurrect
pm2 startup
```

#### **✅ 额外建议（很实用）**



##### **1）强烈建议每个服务都** 

### **--name**



不然以后只用 id 管理会很痛苦。



##### **2）生产环境：开机自启 + pm2 save 必做**



否则服务器重启就没服务了。

### **3）日志太大要定期管理**

pm2 flush 会清空（谨慎）。

更推荐结合 logrotate（如果你需要我也可以给你一套配置）。

